<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Agent 5: Transform Engine Test - Precision Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            margin: 0;
            color: #667eea;
            font-size: 2.5em;
            font-weight: 300;
        }

        .status {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 0;
            font-weight: 600;
            font-size: 0.9em;
        }

        .test-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .test-section h3 {
            margin-top: 0;
            color: #4f46e5;
            font-size: 1.4em;
        }

        .canvas-container {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            background: white;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn.success { background: #10b981; }
        .btn.success:hover { background: #059669; }

        .btn.warning { background: #f59e0b; }
        .btn.warning:hover { background: #d97706; }

        .btn.danger { background: #ef4444; }
        .btn.danger:hover { background: #dc2626; }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin: 5px 0;
        }

        .metric-label {
            font-size: 0.9em;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .log {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .coordinates-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .coordinates-table th,
        .coordinates-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .coordinates-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        .accuracy-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .accuracy-pass {
            background: #d1fae5;
            color: #065f46;
        }

        .accuracy-fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .target-specs {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .target-specs h4 {
            color: #ea580c;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Agent 5: Design Transform Calculator</h1>
            <div class="status">PRECISION ENGINE ACTIVE</div>
            <p>Pixel-perfect coordinate transformation with <1px accuracy</p>
        </div>

        <div class="target-specs">
            <h4>üéØ Target Specifications (Order 5373)</h4>
            <div class="coordinates-table">
                <table class="coordinates-table">
                    <thead>
                        <tr>
                            <th>Element</th>
                            <th>Position (left, top)</th>
                            <th>Scale (X, Y)</th>
                            <th>Angle</th>
                            <th>Target Accuracy</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Image 1 (ylife logo)</td>
                            <td>326, 150</td>
                            <td>11.3%, 11.3%</td>
                            <td>0¬∞</td>
                            <td>&lt;1px tolerance</td>
                        </tr>
                        <tr>
                            <td>Image 2 (yprint logo)</td>
                            <td>406.39, 116.49</td>
                            <td>5.0%, 5.0%</td>
                            <td>0¬∞</td>
                            <td>&lt;1px tolerance</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="test-section">
            <h3>üé® Canvas Precision Test</h3>
            <div class="canvas-container">
                <div id="canvas-container"></div>
            </div>

            <div class="controls">
                <button class="btn success" onclick="runPrecisionTest()">üéØ Run Precision Test</button>
                <button class="btn" onclick="testTransformAccuracy()">üìè Test Accuracy</button>
                <button class="btn warning" onclick="benchmarkPerformance()">‚ö° Benchmark Performance</button>
                <button class="btn" onclick="testViewportResize()">üì± Test Responsive Scaling</button>
                <button class="btn danger" onclick="clearTests()">üóëÔ∏è Clear Tests</button>
            </div>
        </div>

        <div class="test-section">
            <h3>üìä Performance Metrics</h3>
            <div class="metrics" id="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="total-renders">0</div>
                    <div class="metric-label">Total Renders</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="average-time">0ms</div>
                    <div class="metric-label">Average Render Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="fastest-time">0ms</div>
                    <div class="metric-label">Fastest Render</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="accuracy-score">0%</div>
                    <div class="metric-label">Transform Accuracy</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üéØ Transform Accuracy Results</h3>
            <div id="accuracy-results">
                <p>Run precision test to see accuracy results...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üîß System Log</h3>
            <div class="log" id="system-log">
                System initialized. Ready for precision testing...\n
            </div>
        </div>
    </div>

    <!-- Load the transform engine -->
    <script src="admin/js/admin-canvas-renderer.js"></script>
    <script src="admin/js/design-preview-generator.js"></script>

    <script>
        // üéØ AGENT 5: TRANSFORM ENGINE TEST SUITE
        let previewGenerator = null;
        let testResults = [];

        // Initialize the system
        async function initializeTransformEngine() {
            try {
                log('üéØ INITIALIZING: Transform Engine...');

                previewGenerator = new DesignPreviewGenerator();
                const success = previewGenerator.init('canvas-container');

                if (success) {
                    log('‚úÖ SUCCESS: Transform Engine initialized');

                    // Setup resize handler
                    window.addEventListener('resize', () => {
                        if (previewGenerator) {
                            previewGenerator.handleResize('canvas-container');
                        }
                    });

                    return true;
                } else {
                    log('‚ùå ERROR: Failed to initialize Transform Engine');
                    return false;
                }
            } catch (error) {
                log(`‚ùå INITIALIZATION ERROR: ${error.message}`);
                return false;
            }
        }

        // Run precision test with Order 5373 coordinates
        async function runPrecisionTest() {
            if (!previewGenerator) {
                log('‚ùå ERROR: Transform Engine not initialized');
                return;
            }

            try {
                log('üéØ PRECISION TEST: Starting with Order 5373 coordinates...');

                const results = await previewGenerator.createPrecisionTestPreview();
                updateAccuracyDisplay(results);
                updateMetricsDisplay();

                log(`‚úÖ PRECISION TEST COMPLETE: ${results.passed}/${results.passed + results.failed} tests passed`);

            } catch (error) {
                log(`‚ùå PRECISION TEST ERROR: ${error.message}`);
            }
        }

        // Test transform accuracy
        async function testTransformAccuracy() {
            if (!previewGenerator) {
                log('‚ùå ERROR: Transform Engine not initialized');
                return;
            }

            try {
                log('üìè ACCURACY TEST: Testing transform calculations...');

                const results = previewGenerator.testTransformAccuracy();
                updateAccuracyDisplay(results);

                log(`üìè ACCURACY RESULTS: ${results.passed}/${results.passed + results.failed} tests passed`);

            } catch (error) {
                log(`‚ùå ACCURACY TEST ERROR: ${error.message}`);
            }
        }

        // Benchmark rendering performance
        async function benchmarkPerformance() {
            if (!previewGenerator || !previewGenerator.currentData) {
                log('‚ö†Ô∏è WARNING: Run precision test first to generate benchmark data');
                await runPrecisionTest();
            }

            try {
                log('‚ö° BENCHMARK: Testing rendering performance...');

                const benchmark = await previewGenerator.benchmarkPerformance(10);

                if (benchmark.error) {
                    log(`‚ùå BENCHMARK ERROR: ${benchmark.error}`);
                    return;
                }

                log(`‚ö° BENCHMARK RESULTS:`);
                log(`   Total Time: ${benchmark.totalTime}`);
                log(`   Average: ${benchmark.averageTime}`);
                log(`   Best: ${benchmark.minTime}`);
                log(`   Worst: ${benchmark.maxTime}`);

                updateMetricsDisplay();

            } catch (error) {
                log(`‚ùå BENCHMARK ERROR: ${error.message}`);
            }
        }

        // Test viewport resize functionality
        function testViewportResize() {
            if (!previewGenerator) {
                log('‚ùå ERROR: Transform Engine not initialized');
                return;
            }

            log('üì± RESIZE TEST: Simulating viewport changes...');

            // Simulate different viewport sizes
            const container = document.getElementById('canvas-container');
            const originalWidth = container.style.width;

            const testSizes = ['400px', '600px', '800px', '500px'];
            let currentIndex = 0;

            const resizeTest = setInterval(() => {
                if (currentIndex >= testSizes.length) {
                    container.style.width = originalWidth || '';
                    clearInterval(resizeTest);
                    log('üì± RESIZE TEST: Complete - returned to original size');
                    return;
                }

                const newWidth = testSizes[currentIndex];
                container.style.width = newWidth;
                previewGenerator.handleResize('canvas-container');

                log(`üì± RESIZE: Testing ${newWidth} viewport`);
                currentIndex++;
            }, 1000);
        }

        // Clear all tests
        function clearTests() {
            if (previewGenerator) {
                previewGenerator.clearPreview();
            }

            document.getElementById('accuracy-results').innerHTML = '<p>Run precision test to see accuracy results...</p>';
            document.getElementById('system-log').textContent = 'System cleared. Ready for new tests...\n';

            // Reset metrics
            document.getElementById('total-renders').textContent = '0';
            document.getElementById('average-time').textContent = '0ms';
            document.getElementById('fastest-time').textContent = '0ms';
            document.getElementById('accuracy-score').textContent = '0%';

            log('üóëÔ∏è CLEARED: All tests and data cleared');
        }

        // Update accuracy display
        function updateAccuracyDisplay(results) {
            if (!results || results.error) return;

            const container = document.getElementById('accuracy-results');
            const accuracyPercent = Math.round((results.passed / (results.passed + results.failed)) * 100);

            let html = `
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" style="color: ${results.passed === results.passed + results.failed ? '#10b981' : '#ef4444'}">${accuracyPercent}%</div>
                        <div class="metric-label">Overall Accuracy</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: #10b981">${results.passed}</div>
                        <div class="metric-label">Tests Passed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: #ef4444">${results.failed}</div>
                        <div class="metric-label">Tests Failed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${results.tolerance}px</div>
                        <div class="metric-label">Tolerance</div>
                    </div>
                </div>

                <table class="coordinates-table">
                    <thead>
                        <tr>
                            <th>Test</th>
                            <th>Input</th>
                            <th>Expected</th>
                            <th>Actual</th>
                            <th>Error</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            results.details.forEach(detail => {
                html += `
                    <tr>
                        <td>${detail.name}</td>
                        <td>(${detail.input.left}, ${detail.input.top})</td>
                        <td>(${detail.expected.x.toFixed(1)}, ${detail.expected.y.toFixed(1)})</td>
                        <td>(${detail.actual.x}, ${detail.actual.y})</td>
                        <td>${detail.error}</td>
                        <td><span class="accuracy-badge ${detail.passed ? 'accuracy-pass' : 'accuracy-fail'}">${detail.passed ? 'PASS' : 'FAIL'}</span></td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;

            // Update main accuracy score
            document.getElementById('accuracy-score').textContent = `${accuracyPercent}%`;
        }

        // Update metrics display
        function updateMetricsDisplay() {
            if (!previewGenerator) return;

            const metrics = previewGenerator.getPerformanceMetrics();
            if (metrics.error) return;

            document.getElementById('total-renders').textContent = metrics.totalRenders;
            document.getElementById('average-time').textContent = metrics.averageRenderTimeFormatted;
            document.getElementById('fastest-time').textContent = metrics.fastestRenderFormatted;
        }

        // Logging function
        function log(message) {
            const logContainer = document.getElementById('system-log');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.textContent += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async () => {
            log('üöÄ SYSTEM STARTUP: Loading Transform Engine Test Suite...');

            const success = await initializeTransformEngine();
            if (success) {
                log('üéØ READY: Transform Engine Test Suite loaded successfully');
                log('üí° TIP: Click "Run Precision Test" to validate Order 5373 coordinates');
            }
        });
    </script>
</body>
</html>