<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DirectCoordinate Testing Framework - Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
        }

        .header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }

        .status {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .status.active {
            border-color: #4CAF50;
            background: #f9fff9;
        }

        .status.inactive {
            border-color: #ff9800;
            background: #fff9f0;
        }

        .testing-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .test-button {
            background: white;
            border: 2px solid #007cba;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .test-button:hover {
            background: #007cba;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 124, 186, 0.3);
        }

        .test-button h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
        }

        .test-button p {
            margin: 0;
            font-size: 12px;
            opacity: 0.7;
        }

        .results-area {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-height: 400px;
        }

        .results-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }

        .results-content {
            padding: 15px;
        }

        .results-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.4;
        }

        .system-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .system-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .system-card.available {
            border-color: #4CAF50;
            background: #f9fff9;
        }

        .system-card.unavailable {
            border-color: #f44336;
            background: #fff9f9;
            opacity: 0.7;
        }

        .system-card h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
        }

        .system-card .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .system-card .available .status-indicator {
            background: #4CAF50;
        }

        .system-card .unavailable .status-indicator {
            background: #f44336;
        }

        .demo-canvas-area {
            background: white;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            min-height: 200px;
            position: relative;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007cba;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .alert.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .quick-actions {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .quick-actions h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #007cba;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .action-btn:hover {
            background: #005a87;
        }

        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ DirectCoordinate Testing Framework</h1>
            <p>Validierung und Vergleich von Koordinatensystem-Genauigkeit</p>
        </div>

        <!-- Status Section -->
        <div class="status" id="statusSection">
            <h3>Framework Status</h3>
            <div id="frameworkStatus">
                <div class="loading"></div> Checking framework status...
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3>Quick Actions</h3>
            <div class="action-buttons">
                <button class="action-btn" onclick="runFullTest()">üöÄ Run Full Test Suite</button>
                <button class="action-btn" onclick="showCoordinateOverlay()">üé® Show Visual Overlay</button>
                <button class="action-btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
                <button class="action-btn" onclick="refreshSystems()">üîÑ Refresh Systems</button>
                <button class="action-btn" onclick="exportResults()">üìÑ Export Results</button>
            </div>
        </div>

        <!-- System Overview -->
        <div class="system-overview" id="systemOverview">
            <!-- Will be populated by JavaScript -->
        </div>

        <!-- Testing Controls -->
        <div class="testing-controls">
            <div class="test-button" onclick="runAccuracyTest()">
                <h3>üéØ Accuracy Test</h3>
                <p>Vergleicht Koordinaten-Genauigkeit zwischen allen Systemen</p>
            </div>

            <div class="test-button" onclick="runPerformanceTest()">
                <h3>‚ö° Performance Test</h3>
                <p>Misst Capture-Geschwindigkeit und Erfolgsrate</p>
            </div>

            <div class="test-button" onclick="runConsistencyTest()">
                <h3>üîç Consistency Test</h3>
                <p>Pr√ºft 1:1 Koordinaten-Konsistenz √ºber mehrere Durchl√§ufe</p>
            </div>

            <div class="test-button" onclick="generateTestReport()">
                <h3>üìä Generate Report</h3>
                <p>Erstellt umfassenden Test-Report mit Empfehlungen</p>
            </div>
        </div>

        <!-- Demo Canvas Area -->
        <div class="demo-canvas-area" id="demoCanvasArea">
            <h3>Canvas Area</h3>
            <p>Hier werden die Canvas-Elemente f√ºr das Testing dargestellt</p>
            <p><small>Das Framework erkennt automatisch alle verf√ºgbaren Canvas-Instanzen</small></p>
        </div>

        <!-- Results Area -->
        <div class="results-area">
            <div class="results-header">
                Test Results & Debug Output
            </div>
            <div class="results-content" id="resultsContent">
                <div class="alert warning">
                    <strong>Hinweis:</strong> Starten Sie einen Test um Ergebnisse zu sehen.
                </div>
                <p>Verf√ºgbare Debug-Befehle in der Browser-Console:</p>
                <pre>
// Alle verf√ºgbaren Tests
DirectCoordinateTest.compareSystemsAccuracy()  // Genauigkeits-Vergleich
DirectCoordinateTest.measurePerformance()      // Performance-Test
DirectCoordinateTest.validateConsistency()     // Konsistenz-Validierung
DirectCoordinateTest.generateReport()          // Kompletter Report
DirectCoordinateTest.visualizeCoordinates()    // Visual Overlay

// Debug-Zugriff
DirectCoordinateTest.getTestResults()          // Alle Test-Ergebnisse
DirectCoordinateTest.getCoordinateSystems()    // Verf√ºgbare Systeme
DirectCoordinateTest.getDirectCoordinates()    // DirectCoordinate Daten

// System-spezifische Tests
DirectCoordinateTest.captureFromSystem('enhancedJSON')
DirectCoordinateTest.captureFromSystem('directCoordinate')
                </pre>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let testResults = {};
        let isFrameworkActive = false;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkFrameworkStatus();
            refreshSystemOverview();

            // Auto-refresh every 5 seconds
            setInterval(checkFrameworkStatus, 5000);
        });

        /**
         * Check if the testing framework is active
         */
        function checkFrameworkStatus() {
            const statusElement = document.getElementById('frameworkStatus');
            const statusSection = document.getElementById('statusSection');

            if (typeof window.DirectCoordinateTest !== 'undefined') {
                isFrameworkActive = true;
                statusSection.className = 'status active';
                statusElement.innerHTML = `
                    <div class="alert success">
                        <strong>‚úÖ Framework Active</strong><br>
                        DirectCoordinate Testing Framework ist geladen und einsatzbereit.
                    </div>
                    <p><strong>Aktivierungsinfo:</strong> URL Parameter <code>?coordinate_testing=1</code> erkannt</p>
                `;
            } else {
                isFrameworkActive = false;
                statusSection.className = 'status inactive';
                statusElement.innerHTML = `
                    <div class="alert warning">
                        <strong>‚ö†Ô∏è Framework Inactive</strong><br>
                        DirectCoordinate Testing Framework ist nicht aktiv.
                    </div>
                    <p><strong>Aktivierung:</strong> F√ºgen Sie <code>?coordinate_testing=1</code> zur URL hinzu</p>
                    <p><strong>Aktuelle URL:</strong> <a href="${window.location.href}?coordinate_testing=1">${window.location.href}?coordinate_testing=1</a></p>
                `;
            }
        }

        /**
         * Refresh system overview display
         */
        function refreshSystemOverview() {
            const overviewElement = document.getElementById('systemOverview');

            if (!isFrameworkActive) {
                overviewElement.innerHTML = '<div class="alert warning">Framework muss aktiv sein um Systeme anzuzeigen</div>';
                return;
            }

            const systems = window.DirectCoordinateTest?.getCoordinateSystems() || {};
            let html = '';

            for (const [key, system] of Object.entries(systems)) {
                const available = !!system.instance;
                const statusClass = available ? 'available' : 'unavailable';

                html += `
                    <div class="system-card ${statusClass}">
                        <h4>
                            <span class="status-indicator"></span>
                            ${system.name}
                        </h4>
                        <p><strong>Type:</strong> ${system.type}</p>
                        <p><strong>Method:</strong> ${system.captureMethod}</p>
                        <p><strong>Status:</strong> ${available ? 'Available' : 'Not Available'}</p>
                    </div>
                `;
            }

            overviewElement.innerHTML = html;
        }

        /**
         * Run accuracy test
         */
        async function runAccuracyTest() {
            if (!isFrameworkActive) {
                showError('Framework ist nicht aktiv. F√ºgen Sie ?coordinate_testing=1 zur URL hinzu.');
                return;
            }

            showLoading('Running accuracy test...');

            try {
                const result = await window.DirectCoordinateTest.compareSystemsAccuracy();
                testResults.accuracy = result;
                displayResults('Accuracy Test Results', result);
            } catch (error) {
                showError(`Accuracy Test Error: ${error.message}`);
            }
        }

        /**
         * Run performance test
         */
        async function runPerformanceTest() {
            if (!isFrameworkActive) {
                showError('Framework ist nicht aktiv. F√ºgen Sie ?coordinate_testing=1 zur URL hinzu.');
                return;
            }

            showLoading('Running performance test...');

            try {
                const result = await window.DirectCoordinateTest.measurePerformance();
                testResults.performance = result;
                displayResults('Performance Test Results', result);
            } catch (error) {
                showError(`Performance Test Error: ${error.message}`);
            }
        }

        /**
         * Run consistency test
         */
        async function runConsistencyTest() {
            if (!isFrameworkActive) {
                showError('Framework ist nicht aktiv. F√ºgen Sie ?coordinate_testing=1 zur URL hinzu.');
                return;
            }

            showLoading('Running consistency test (this may take a moment)...');

            try {
                const result = await window.DirectCoordinateTest.validateConsistency();
                testResults.consistency = result;
                displayResults('Consistency Test Results', result);
            } catch (error) {
                showError(`Consistency Test Error: ${error.message}`);
            }
        }

        /**
         * Generate comprehensive test report
         */
        async function generateTestReport() {
            if (!isFrameworkActive) {
                showError('Framework ist nicht aktiv. F√ºgen Sie ?coordinate_testing=1 zur URL hinzu.');
                return;
            }

            showLoading('Generating comprehensive test report...');

            try {
                const result = await window.DirectCoordinateTest.generateReport();
                testResults.report = result;
                displayResults('Comprehensive Test Report', result);
            } catch (error) {
                showError(`Report Generation Error: ${error.message}`);
            }
        }

        /**
         * Run complete test suite
         */
        async function runFullTest() {
            if (!isFrameworkActive) {
                showError('Framework ist nicht aktiv. F√ºgen Sie ?coordinate_testing=1 zur URL hinzu.');
                return;
            }

            showLoading('Running full test suite...');

            try {
                // Run all tests in sequence
                await runAccuracyTest();
                await new Promise(resolve => setTimeout(resolve, 1000));

                await runPerformanceTest();
                await new Promise(resolve => setTimeout(resolve, 1000));

                await runConsistencyTest();
                await new Promise(resolve => setTimeout(resolve, 1000));

                await generateTestReport();

                showSuccess('Full test suite completed successfully!');
            } catch (error) {
                showError(`Full Test Suite Error: ${error.message}`);
            }
        }

        /**
         * Show coordinate overlay
         */
        function showCoordinateOverlay() {
            if (!isFrameworkActive) {
                showError('Framework ist nicht aktiv. F√ºgen Sie ?coordinate_testing=1 zur URL hinzu.');
                return;
            }

            try {
                window.DirectCoordinateTest.visualizeCoordinates();
                showSuccess('Visual coordinate overlay activated! Check the canvas area.');
            } catch (error) {
                showError(`Visualization Error: ${error.message}`);
            }
        }

        /**
         * Clear all results
         */
        function clearResults() {
            testResults = {};
            document.getElementById('resultsContent').innerHTML = `
                <div class="alert warning">
                    <strong>Results Cleared:</strong> Start a new test to see results.
                </div>
            `;
        }

        /**
         * Refresh systems
         */
        function refreshSystems() {
            checkFrameworkStatus();
            refreshSystemOverview();
            showSuccess('System overview refreshed.');
        }

        /**
         * Export test results
         */
        function exportResults() {
            if (Object.keys(testResults).length === 0) {
                showError('No test results to export. Run some tests first.');
                return;
            }

            const dataStr = JSON.stringify(testResults, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = `coordinate-test-results-${new Date().toISOString().split('T')[0]}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();

            showSuccess('Test results exported successfully!');
        }

        /**
         * Display test results
         */
        function displayResults(title, data) {
            const resultsContent = document.getElementById('resultsContent');

            resultsContent.innerHTML = `
                <div class="alert success">
                    <strong>${title} Completed</strong>
                </div>
                <h4>${title}</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;

            // Scroll to results
            resultsContent.scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * Show loading message
         */
        function showLoading(message) {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `
                <div class="alert warning">
                    <div class="loading"></div> ${message}
                </div>
            `;
        }

        /**
         * Show success message
         */
        function showSuccess(message) {
            const resultsContent = document.getElementById('resultsContent');
            const currentContent = resultsContent.innerHTML;
            resultsContent.innerHTML = `
                <div class="alert success">
                    <strong>‚úÖ Success:</strong> ${message}
                </div>
                ${currentContent}
            `;
        }

        /**
         * Show error message
         */
        function showError(message) {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `
                <div class="alert error">
                    <strong>‚ùå Error:</strong> ${message}
                </div>
            `;
        }
    </script>
</body>
</html>